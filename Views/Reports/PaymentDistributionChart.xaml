<UserControl x:Class="WPFGrowerApp.Views.Reports.PaymentDistributionChart"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:converters="clr-namespace:WPFGrowerApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="400" d:DesignWidth="600">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/WPFGrowerApp;component/Styles/StandardizedViewTemplate.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <converters:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <converters:CollectionSumConverter x:Key="CollectionSumConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <materialDesign:Card Style="{StaticResource KPICardStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Chart Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                <materialDesign:PackIcon Kind="ChartPie" Width="24" Height="24" 
                                         Foreground="{DynamicResource PrimaryHueMidBrush}" 
                                         VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Payment Distribution" 
                           Style="{StaticResource MaterialDesignHeadline6TextBlock}" 
                           VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Chart Area -->
            <Grid Grid.Row="1" MinHeight="300">
                <syncfusion:SfChart Header="Payment Distribution by Type"
                                    Margin="0,10"
                                    Background="Transparent">
                    
                    <!-- Chart Primary Axis -->
                    <syncfusion:SfChart.PrimaryAxis>
                        <syncfusion:CategoryAxis Header="Payment Types" 
                                                LabelFormat="C0"
                                                ShowGridLines="True"/>
                    </syncfusion:SfChart.PrimaryAxis>
                    
                    <!-- Chart Secondary Axis -->
                    <syncfusion:SfChart.SecondaryAxis>
                        <syncfusion:NumericalAxis Header="Amount ($)" 
                                                  LabelFormat="C0"
                                                  ShowGridLines="True"/>
                    </syncfusion:SfChart.SecondaryAxis>
                    
                    <!-- Pie Chart Series -->
                    <syncfusion:PieSeries ItemsSource="{Binding}"
                                          XBindingPath="Category"
                                          YBindingPath="Value"
                                          EnableAnimation="True"
                                          ExplodeOnMouseClick="True"
                                          ExplodeRadius="15"
                                          ExplodeIndex="0"
                                          Palette="Metro">
                        
                        <!-- Tooltip Configuration -->
                        <syncfusion:PieSeries.TooltipTemplate>
                            <DataTemplate>
                                <Border Background="#333333" 
                                        CornerRadius="4" 
                                        Padding="8,4" 
                                        BorderBrush="#666666" 
                                        BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Category}" 
                                                   Foreground="White" 
                                                   FontWeight="Bold" 
                                                   FontSize="12"/>
                                        <TextBlock Text="{Binding Description}" 
                                                   Foreground="#CCCCCC" 
                                                   FontSize="10" 
                                                   Margin="0,2,0,0"/>
                                        <TextBlock Text="{Binding Value, StringFormat={}{0:C2}}" 
                                                   Foreground="#4CAF50" 
                                                   FontWeight="SemiBold" 
                                                   FontSize="11" 
                                                   Margin="0,2,0,0"/>
                                        <TextBlock Text="{Binding Percentage, StringFormat={}{0:F1}%}" 
                                                   Foreground="#FFC107" 
                                                   FontWeight="SemiBold" 
                                                   FontSize="11" 
                                                   Margin="0,1,0,0"/>
                                        <TextBlock Text="{Binding Count, StringFormat={}{0} growers}" 
                                                   Foreground="#2196F3" 
                                                   FontSize="10" 
                                                   Margin="0,1,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </syncfusion:PieSeries.TooltipTemplate>
                    </syncfusion:PieSeries>
                    
                    <!-- Chart Legend -->
                    <syncfusion:SfChart.Legend>
                        <syncfusion:ChartLegend DockPosition="Bottom" 
                                                HorizontalAlignment="Center"
                                                Margin="0,10,0,0"/>
                    </syncfusion:SfChart.Legend>
                </syncfusion:SfChart>
                
                <!-- No Data Message -->
                <TextBlock Text="No payment data available" 
                           Style="{StaticResource MaterialDesignBody2TextBlock}" 
                           Opacity="0.7" 
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding Count, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
            </Grid>
            
            <!-- Chart Summary -->
            <Grid Grid.Row="2" Margin="0,15,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="Total Payments" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource CollectionSumConverter}" ConverterParameter="Value"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="Advance Payments" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource CollectionSumConverter}" ConverterParameter="Advance"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="Final Payments" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource CollectionSumConverter}" ConverterParameter="Final"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="Payment Count" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}">
                                <Binding Path="." Converter="{StaticResource CollectionSumConverter}" ConverterParameter="Count"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:Card>
</UserControl>
