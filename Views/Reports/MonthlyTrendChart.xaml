<UserControl x:Class="WPFGrowerApp.Views.Reports.MonthlyTrendChart"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:converters="clr-namespace:WPFGrowerApp.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="400" d:DesignWidth="800">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/WPFGrowerApp;component/Styles/StandardizedViewTemplate.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <converters:BoolToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <converters:MonthlyTrendConverter x:Key="MonthlyTrendConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <materialDesign:Card Style="{StaticResource KPICardStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Chart Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                <materialDesign:PackIcon Kind="TrendingUp" Width="24" Height="24" 
                                         Foreground="{DynamicResource PrimaryHueMidBrush}" 
                                         VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Monthly Payment Trends" 
                           Style="{StaticResource MaterialDesignHeadline6TextBlock}" 
                           VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Chart Area -->
            <Grid Grid.Row="1" MinHeight="300">
                <syncfusion:SfChart Header="Payment Trends Over Time"
                                    Margin="0,10"
                                    Background="Transparent">
                    
                    <!-- Chart Primary Axis -->
                    <syncfusion:SfChart.PrimaryAxis>
                        <syncfusion:DateTimeAxis Header="Month" 
                                                IntervalType="Months"
                                                Interval="1"
                                                LabelFormat="MMM yyyy"
                                                ShowGridLines="True"/>
                    </syncfusion:SfChart.PrimaryAxis>
                    
                    <!-- Chart Secondary Axis -->
                    <syncfusion:SfChart.SecondaryAxis>
                        <syncfusion:NumericalAxis Header="Amount ($)" 
                                                  LabelFormat="C0"
                                                  ShowGridLines="True"/>
                    </syncfusion:SfChart.SecondaryAxis>
                    
                    <!-- Total Payments Line Series -->
                    <syncfusion:LineSeries ItemsSource="{Binding}"
                                           XBindingPath="Month"
                                           YBindingPath="TotalPayments"
                                           EnableAnimation="True"
                                           StrokeThickness="3"
                                           Stroke="#FF6384"/>
                    
                    <!-- Advance 1 Line Series -->
                    <syncfusion:LineSeries ItemsSource="{Binding}"
                                           XBindingPath="Month"
                                           YBindingPath="Advance1Amount"
                                           EnableAnimation="True"
                                           StrokeThickness="2"
                                           Stroke="#36A2EB"/>
                    
                    <!-- Advance 2 Line Series -->
                    <syncfusion:LineSeries ItemsSource="{Binding}"
                                           XBindingPath="Month"
                                           YBindingPath="Advance2Amount"
                                           EnableAnimation="True"
                                           StrokeThickness="2"
                                           Stroke="#FFCE56"/>
                    
                    <!-- Advance 3 Line Series -->
                    <syncfusion:LineSeries ItemsSource="{Binding}"
                                           XBindingPath="Month"
                                           YBindingPath="Advance3Amount"
                                           EnableAnimation="True"
                                           StrokeThickness="2"
                                           Stroke="#4BC0C0"/>
                    
                    <!-- Final Payment Line Series -->
                    <syncfusion:LineSeries ItemsSource="{Binding}"
                                           XBindingPath="Month"
                                           YBindingPath="FinalPaymentAmount"
                                           EnableAnimation="True"
                                           StrokeThickness="2"
                                           Stroke="#9966FF"/>
                    
                    <!-- Chart Legend -->
                    <syncfusion:SfChart.Legend>
                        <syncfusion:ChartLegend DockPosition="Bottom" 
                                                HorizontalAlignment="Center"
                                                Margin="0,10,0,0"/>
                    </syncfusion:SfChart.Legend>
                </syncfusion:SfChart>
                
                <!-- No Data Message -->
                <TextBlock Text="No trend data available" 
                           Style="{StaticResource MaterialDesignBody2TextBlock}" 
                           Opacity="0.7" 
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding Count, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>
            </Grid>
            
            <!-- Chart Summary -->
            <Grid Grid.Row="2" Margin="0,15,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="Peak Month" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}">
                                <Binding Path="." Converter="{StaticResource MonthlyTrendConverter}" ConverterParameter="PeakMonth"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="Peak Amount" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource MonthlyTrendConverter}" ConverterParameter="PeakAmount"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="Average Monthly" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource MonthlyTrendConverter}" ConverterParameter="AverageMonthly"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="Total Payments" 
                               Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                               Opacity="0.7" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:C0}">
                                <Binding Path="." Converter="{StaticResource MonthlyTrendConverter}" ConverterParameter="TotalPayments"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:Card>
</UserControl>
