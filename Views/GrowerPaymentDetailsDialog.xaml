<Window x:Class="WPFGrowerApp.Views.GrowerPaymentDetailsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="Payment Details" 
        Height="600" 
        Width="800"
        MinHeight="400"
        MinWidth="600"
        MaxHeight="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ActualHeight}"
        MaxWidth="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ActualWidth}"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/StandardizedViewTemplate.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="{Binding GrowerDisplay}" 
                       Style="{DynamicResource MaterialDesignHeadline4TextBlock}"
                       Margin="0,0,0,10"/>
            <TextBlock Text="Payment Details" 
                       Style="{DynamicResource MaterialDesignSubtitle1TextBlock}"
                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- Scrollable Content -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Auto"
                      CanContentScroll="True">
            <StackPanel Margin="0,0,0,20">
                
                <!-- Batch Information -->
                <materialDesign:Card Margin="0,0,0,20">
                    <StackPanel Margin="15">
                        <TextBlock Text="Batch Information" 
                                   Style="{DynamicResource MaterialDesignSubtitle1TextBlock}" 
                                   Margin="0,0,0,15"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Selected Batches" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding SelectedBatchesCount}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Total Gross Amount" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding TotalGrossAmountDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Payment Method" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="Cheque" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Payment Date" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding PaymentDateDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Receipt Breakdown -->
                <materialDesign:Card Margin="0,0,0,20">
                    <StackPanel Margin="15">
                        <TextBlock Text="Receipt Breakdown" 
                                   Style="{DynamicResource MaterialDesignSubtitle1TextBlock}" 
                                   Margin="0,0,0,15"/>
                        
                        <DataGrid ItemsSource="{Binding ReceiptBreakdowns, Mode=OneWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"
                                  CanUserResizeColumns="True"
                                  CanUserSortColumns="True"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  MaxHeight="200"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Receipt #" 
                                                    Binding="{Binding ReceiptNumber}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Product" 
                                                    Binding="{Binding ProductName}" 
                                                    Width="120" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Process" 
                                                    Binding="{Binding ProcessName}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Weight (lbs)" 
                                                    Binding="{Binding FinalWeight, StringFormat=N2}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Price/lb" 
                                                    Binding="{Binding PricePerPound, StringFormat=C2}" 
                                                    Width="80" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Amount" 
                                                    Binding="{Binding TotalAmountPaid, StringFormat=C}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Batch" 
                                                    Binding="{Binding BatchName}" 
                                                    Width="80" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Advance #" 
                                                    Binding="{Binding PaymentTypeName}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Receipt Summary -->
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBlock Text="Total Receipts: " FontWeight="SemiBold" Margin="0,0,20,0"/>
                            <TextBlock Text="{Binding TotalReceipts, Mode=OneWay}" Margin="0,0,20,0"/>
                            <TextBlock Text="Total Weight: " FontWeight="SemiBold" Margin="0,0,20,0"/>
                            <TextBlock Text="{Binding TotalWeightDisplay, Mode=OneWay}" Margin="0,0,20,0"/>
                            <TextBlock Text="Average Price: " FontWeight="SemiBold" Margin="0,0,20,0"/>
                            <TextBlock Text="{Binding AveragePricePerPoundDisplay, Mode=OneWay}"/>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Payment Calculation -->
                <materialDesign:Card Margin="0,0,0,20">
                    <StackPanel Margin="15">
                        <TextBlock Text="Payment Calculation" 
                                   Style="{DynamicResource MaterialDesignSubtitle1TextBlock}" 
                                   Margin="0,0,0,15"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Gross Amount" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding TotalGrossAmountDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Deduct From This Transaction" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding DeductFromThisTransactionDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Net Payment Amount" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding NetPaymentAmountDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Remaining Deductions" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding RemainingDeductionsDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Advance Deductions Detail -->
                <materialDesign:Card Margin="0,0,0,20">
                    <StackPanel Margin="15">
                        <TextBlock Text="Advance Deductions Detail" 
                                   Style="{DynamicResource MaterialDesignSubtitle1TextBlock}" 
                                   Margin="0,0,0,15"/>
                        
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Outstanding Advances" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding OutstandingAdvancesDisplay}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Advance Cheques Used" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="{Binding AdvanceChequesCount}" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Status" Style="{DynamicResource MaterialDesignCaptionTextBlock}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                <TextBlock Text="Outstanding" FontSize="16" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Advance Cheque Details:" 
                                   Style="{DynamicResource MaterialDesignSubtitle2TextBlock}" 
                                   Margin="0,0,0,10"/>
                        
                        <DataGrid ItemsSource="{Binding AdvanceCheques, Mode=OneWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"
                                  CanUserResizeColumns="True"
                                  CanUserSortColumns="True"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  MaxHeight="200"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Cheque #" 
                                                    Binding="{Binding ChequeNumber}" 
                                                    Width="120" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Advance Date" 
                                                    Binding="{Binding AdvanceDateDisplay}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Original Amount" 
                                                    Binding="{Binding OriginalAmountDisplay}" 
                                                    Width="120" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Remaining Amount" 
                                                    Binding="{Binding RemainingAmountDisplay}" 
                                                    Width="120" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Applied This Transaction" 
                                                    Binding="{Binding AppliedThisTransactionDisplay}" 
                                                    Width="150" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Remaining After Transaction" 
                                                    Binding="{Binding RemainingAfterTransactionDisplay}" 
                                                    Width="180" 
                                                    IsReadOnly="True"/>
                                
                                <DataGridTextColumn Header="Status" 
                                                    Binding="{Binding Status}" 
                                                    Width="100" 
                                                    IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Summary -->
                <materialDesign:Card>
                    <StackPanel Margin="15">
                        <TextBlock Text="Summary" 
                                   Style="{DynamicResource MaterialDesignSubtitle1TextBlock}" 
                                   Margin="0,0,0,15"/>
                        
                        <StackPanel>
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Total Receipts: " FontWeight="SemiBold"/>
                                <Run Text="{Binding TotalReceipts, Mode=OneWay}"/>
                            </TextBlock>
                            
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Total Weight: " FontWeight="SemiBold"/>
                                <Run Text="{Binding TotalWeightDisplay, Mode=OneWay}"/>
                            </TextBlock>
                            
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Average Price: " FontWeight="SemiBold"/>
                                <Run Text="{Binding AveragePricePerPoundDisplay, Mode=OneWay}"/>
                            </TextBlock>
                            
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Advance Cheques: " FontWeight="SemiBold"/>
                                <Run Text="{Binding AdvanceChequesCount, Mode=OneWay}"/>
                            </TextBlock>
                            
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Net Payment: " FontWeight="SemiBold"/>
                                <Run Text="{Binding NetPaymentAmountDisplay, Mode=OneWay}"/>
                            </TextBlock>
                            
                            <TextBlock Margin="0,0,0,5">
                                <Run Text="• Remaining Deductions: " FontWeight="SemiBold"/>
                                <Run Text="{Binding RemainingDeductionsDisplay, Mode=OneWay}"/>
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- Close Button -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <Button Content="Close" 
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Padding="15,5"/>
        </StackPanel>
    </Grid>
</Window>
